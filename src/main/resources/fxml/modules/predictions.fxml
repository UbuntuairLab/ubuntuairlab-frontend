<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx" 
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.aige.apronsmart.controllers.modules.PredictionsController"
            styleClass="dashboard-root">
    
    <!-- Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="header">
            <padding><Insets top="15" right="20" bottom="15" left="20"/></padding>
            
            <Button text="â†" onAction="#handleBack" styleClass="back-button"/>
            <Label text="PrÃ©dictions ML" styleClass="header-title"/>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <Button fx:id="batchPredictButton" text="ðŸ”® PrÃ©dire Tous les Vols" onAction="#handleBatchPredict" styleClass="success-button"/>
            <Button fx:id="checkHealthButton" text="âš• SantÃ© API ML" onAction="#handleCheckHealth" styleClass="secondary-button"/>
            <Button fx:id="refreshButton" text="ðŸ”„ Actualiser" onAction="#handleRefresh" styleClass="primary-button"/>
        </HBox>
    </top>
    
    <!-- Content -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="content-scroll">
            <VBox spacing="20" styleClass="content-container">
                <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                
                <!-- Flight Selection -->
                <VBox spacing="10" styleClass="card">
                    <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                    
                    <Label text="1. SÃ©lection du Vol" styleClass="section-title"/>
                    
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="Vol:" minWidth="100"/>
                        <ComboBox fx:id="flightComboBox" promptText="Choisir un vol..." prefWidth="300"/>
                        <Button text="Charger vols actifs" onAction="#handleLoadFlights" styleClass="secondary-button"/>
                    </HBox>
                    
                    <Separator/>
                    
                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints minWidth="120" prefWidth="120"/>
                            <ColumnConstraints hgrow="ALWAYS"/>
                        </columnConstraints>
                        
                        <Label text="ICAO24:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <Label fx:id="icao24Label" text="-" GridPane.rowIndex="0" GridPane.columnIndex="1" styleClass="value-label"/>
                        
                        <Label text="Callsign:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <Label fx:id="callsignLabel" text="-" GridPane.rowIndex="1" GridPane.columnIndex="1" styleClass="value-label"/>
                        
                        <Label text="Type:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <Label fx:id="flightTypeLabel" text="-" GridPane.rowIndex="2" GridPane.columnIndex="1" styleClass="value-label"/>
                        
                        <Label text="Statut:" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <Label fx:id="statusLabel" text="-" GridPane.rowIndex="3" GridPane.columnIndex="1" styleClass="value-label"/>
                    </GridPane>
                </VBox>
                
                <!-- Prediction Parameters (Optional Override) -->
                <VBox spacing="10" styleClass="card">
                    <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                    
                    <Label text="2. ParamÃ¨tres (Optionnel - auto-rempli si vide)" styleClass="section-title"/>
                    
                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints minWidth="150" prefWidth="150"/>
                            <ColumnConstraints prefWidth="200"/>
                            <ColumnConstraints minWidth="150" prefWidth="150"/>
                            <ColumnConstraints prefWidth="200"/>
                        </columnConstraints>
                        
                        <Label text="Altitude (ft):" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <TextField fx:id="altitudeField" promptText="Auto" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                        
                        <Label text="Vitesse (kts):" GridPane.rowIndex="0" GridPane.columnIndex="2"/>
                        <TextField fx:id="speedField" promptText="Auto" GridPane.rowIndex="0" GridPane.columnIndex="3"/>
                        
                        <Label text="Distance piste (km):" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <TextField fx:id="distanceField" promptText="Auto" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                        
                        <Label text="TempÃ©rature (Â°C):" GridPane.rowIndex="1" GridPane.columnIndex="2"/>
                        <TextField fx:id="temperatureField" promptText="Auto" GridPane.rowIndex="1" GridPane.columnIndex="3"/>
                    </GridPane>
                    
                    <HBox spacing="10" alignment="CENTER">
                        <Button text="ðŸ§¹ RÃ©initialiser" onAction="#handleResetFields" styleClass="secondary-button"/>
                    </HBox>
                </VBox>
                
                <!-- Action Button -->
                <HBox alignment="CENTER" spacing="15">
                    <Button fx:id="predictButton" text="ðŸ¤– Lancer la PrÃ©diction ML" onAction="#handlePredict" 
                            styleClass="primary-button" prefWidth="300" prefHeight="45"/>
                </HBox>
                
                <!-- Results Container -->
                <VBox fx:id="resultsContainer" spacing="15" visible="false" managed="false">
                    
                    <!-- Model 1: ETA -->
                    <VBox spacing="10" styleClass="card prediction-card">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        
                        <Label text="ðŸ“Š ModÃ¨le 1 - PrÃ©diction ETA et Retards" styleClass="section-title"/>
                        
                        <GridPane hgap="20" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints minWidth="200" prefWidth="200"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                            </columnConstraints>
                            
                            <Label text="ETA AjustÃ©:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="label-bold"/>
                            <Label fx:id="etaLabel" text="-" GridPane.rowIndex="0" GridPane.columnIndex="1" styleClass="value-highlight"/>
                            
                            <Label text="ProbabilitÃ© retard 15 min:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <Label fx:id="delay15Label" text="-" GridPane.rowIndex="1" GridPane.columnIndex="1" styleClass="value-label"/>
                            
                            <Label text="ProbabilitÃ© retard 30 min:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <Label fx:id="delay30Label" text="-" GridPane.rowIndex="2" GridPane.columnIndex="1" styleClass="value-label"/>
                        </GridPane>
                    </VBox>
                    
                    <!-- Model 2: Occupation -->
                    <VBox spacing="10" styleClass="card prediction-card">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        
                        <Label text="â±ï¸ ModÃ¨le 2 - DurÃ©e d'Occupation au Poste" styleClass="section-title"/>
                        
                        <GridPane hgap="20" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints minWidth="200" prefWidth="200"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                            </columnConstraints>
                            
                            <Label text="DurÃ©e estimÃ©e:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="label-bold"/>
                            <Label fx:id="occupationLabel" text="-" GridPane.rowIndex="0" GridPane.columnIndex="1" styleClass="value-highlight"/>
                            
                            <Label text="Intervalle (min - max):" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <Label fx:id="occupationRangeLabel" text="-" GridPane.rowIndex="1" GridPane.columnIndex="1" styleClass="value-label"/>
                        </GridPane>
                    </VBox>
                    
                    <!-- Model 3: Conflicts -->
                    <VBox spacing="10" styleClass="card prediction-card">
                        <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                        
                        <Label text="âš ï¸ ModÃ¨le 3 - DÃ©tection de Conflits" styleClass="section-title"/>
                        
                        <GridPane hgap="20" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints minWidth="200" prefWidth="200"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                            </columnConstraints>
                            
                            <Label text="DÃ©cision recommandÃ©e:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="label-bold"/>
                            <Label fx:id="decisionLabel" text="-" GridPane.rowIndex="0" GridPane.columnIndex="1" styleClass="value-highlight"/>
                            
                            <Label text="Risque de conflit:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <Label fx:id="conflictRiskLabel" text="-" GridPane.rowIndex="1" GridPane.columnIndex="1" styleClass="value-label"/>
                            
                            <Label text="Risque de saturation:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <Label fx:id="saturationRiskLabel" text="-" GridPane.rowIndex="2" GridPane.columnIndex="1" styleClass="value-label"/>
                            
                            <Label text="Explication:" GridPane.rowIndex="3" GridPane.columnIndex="0" styleClass="label-bold"/>
                            <Label fx:id="explanationLabel" text="-" GridPane.rowIndex="3" GridPane.columnIndex="1" 
                                   styleClass="value-label" wrapText="true"/>
                        </GridPane>
                    </VBox>
                    
                    <!-- Metadata -->
                    <HBox spacing="20" alignment="CENTER" styleClass="metadata-box">
                        <Label fx:id="timestampLabel" text="Timestamp: -" styleClass="metadata-label"/>
                        <Separator orientation="VERTICAL"/>
                        <Label fx:id="versionLabel" text="Version: -" styleClass="metadata-label"/>
                    </HBox>
                </VBox>
                
            </VBox>
        </ScrollPane>
    </center>
    
</BorderPane>
